BrAcc:
<span >
    <select class="selectedNavBraccCl" [(ngModel)] = "navSelectionSelected" (change)="onNavSelectedChange($event)">
        <option *ngFor="let item of uiNavSel" [value]="item">{{item}}</option>
    </select>
</span>
MarketBar
<span>
    <span *ngFor="let item of uiMktBar"> 
        <a href="https://uk.tradingview.com/chart/?symbol={{item.symbol}}" target="_blank">{{item.symbol}}</a>: 
        <span [ngClass]="{
            'mktBarPositivePerf' : item.pctChg > 0,
            'mktbarNegativePerf' : item.pctChg < 0
         }">{{item.pctChg | percent:'1.2'}},
        </span>
    </span>
    <span *ngFor="let item of uiMktBar"> {{item.lstValTime | date:'mm:ss'}}</span>   
    
</span>
<hr>
<div>
    <span>
    <div class="AccSumm">
        <h4>Account Summary</h4>
        <span id="plSum" class="tooltipCell">P&L Today
            <span id="notImpInfo">(Positions)</span> : 
            <span [ngClass]="{
                'mktBarPositivePerf' : uiSnapTable.sumPlTodVal > 0,
                'mktbarNegativePerf' : uiSnapTable.sumPlTodVal < 0
                }">{{uiSnapTable.sumPlTodVal | currency:'USD':'symbol':'1.0' }}
            </span>
            <span id="notImpInfo" [ngClass]="{
                'mktBarPositivePerf' : uiSnapTable.sumPlTodPct > 0,
                'mktbarNegativePerf' : uiSnapTable.sumPlTodPct < 0
                }">({{uiSnapTable.sumPlTodPct | percent:'1.2'}})
            </span> 
            <div class="tooltipSnap">
                <div class="snapshot">
                    Profit is calculated as <br>a sum of the table cells 
                </div>
            </div>
        </span>
        <span id="plSum" class="tooltipCell">
            <div class="tooltipSnap">
                <div class="snapshot">
                    Force reload snapshot table<br> (Realtime: NAV, #Pos, EstPrice)
                </div>
            </div>
            <span id="refresh"><img id="refresh" border='0' alt='YF' src='../assets/images/refresh64.webp' (click)="onSnapshotRefreshClicked($event)" width='15' height='15'></span>
        </span>
        <span id="notImpInfo">{{uiSnapTable.snapLastUpateTime | date:'H:mm'}} ({{uiSnapTable.snapLastUpdateTimeAgoStr}})</span>
        <div id="plSum" class="tooltipCell">NAV :
            <span id="liqVal">
                {{uiSnapTable.netLiquidationStr | currency:'USD':'symbol':'1.0'}} {{uiSnapTable.rtPriceLastUpdate}}
            </span>
            <div class="tooltipSnap">
                <div class="snapshot">
                    Total NetLiquidation<br>(with cash) 
                </div>
            </div>
        </div>
        <div id="plSum" class="tooltipCell">P&L Today
            <span id="notImpInfo"> (PriorNAV)</span> : 
            <span [ngClass]="{
                'mktBarPositivePerf' : uiSnapTable.plTodPrNav > 0,
                'mktbarNegativePerf' : uiSnapTable.plTodPrNav < 0
                }"> {{uiSnapTable.plTodPrNav | currency:'USD':'symbol':'1.0'}}
            </span>
            <span id="notImpInfo" [ngClass]="{
                'mktBarPositivePerf' : uiSnapTable.pctChgTodPrNav > 0,
                'mktbarNegativePerf' : uiSnapTable.pctChgTodPrNav < 0
                }"> ({{uiSnapTable.pctChgTodPrNav | percent:'1.2'}})
            </span>
            <div class="tooltipSnap">
                <div class="snapshot">
                    Profit is calculated from<br> current  and previous day NAV 
                </div>
            </div> 
        </div>
        <div>
            <span class="tab">
                <button [ngStyle]="{'background-color':tabPageVisibleIdx == 1 ? 'aqua':''}"(click)="tabHeaderClicked($event,1)"> MoreDetails </button>
                <button [ngStyle]="{'background-color':tabPageVisibleIdx == 2 ? 'aqua':''}"(click)="tabHeaderClicked($event,2)"> HistoricalChart </button>
            </span>
        </div>
    </div>
    <div class="ChartSumm">
            <div [hidden]="tabPageVisibleIdx != 1" id="tab1">
                <div class="moreDetailsPartitions">
                    <div>PriorNAV: <span id="moreDetailsSum">{{uiSnapTable.priorCloseNetLiquidation}}</span></div>
                    <div>IB Total Cash: <span id="moreDetailsSum">{{uiSnapTable.totalCashValue | number}}</span></div>
                    <div>IB Initial MarginReq: <span id="moreDetailsSum">{{uiSnapTable.initialMarginReq | number}}</span></div>
                    <div>IB Maintenance MarginReq: <span id="moreDetailsSum">{{uiSnapTable.maintMarginReq | number}}</span></div>
                    <div>IB Gross Position Value: <span id="moreDetailsSum">{{uiSnapTable.grossPositionValue | number}}</span></div>
                </div>
                <div class="moreDetailsPartitions">
                    <div>Number Of Positions: <span id="moreDetailsSum">{{uiSnapTable.numOfPoss}}</span></div>
                    <div>Long Stock MktValue: 
                        <span id="moreDetailsSum" class="tooltipCell">{{uiSnapTable.longStcokValue | number}}*
                            <div class="tooltipSnap">
                                <div class="snapshot">
                                    !! Long VXX is here, although it is market bearish.<br>
                                     'Short VXX', 'short SH' are market bullish, but not here.
                                </div>
                            </div>
                        </span>
                        </div>
                    <div>Short Stock MktValue: <span id="moreDetailsSum">{{uiSnapTable.shortStockValue | number}}</span></div>
                    <div>Call Option Delta Adjusted DelivValue: <span id="moreDetailsSum"></span></div>
                    <div>Put Option Delta Adjusted DelivValue: <span id="moreDetailsSum"></span></div>
                </div>
                <div class="moreDetailsPartitions" id="borderRemove">
                    <div class="tooltipCell">Max Risked estimate:
                        <span id="moreDetailsSum"
                        [ngClass]="{'green' : uiSnapTable.totalMaxRiskedLeverage < 1.3,
                                    'orange': uiSnapTable.totalMaxRiskedLeverage >= 1.3 || uiSnapTable.totalMaxRiskedLeverage <= 1.5,
                                    'red' : uiSnapTable.totalMaxRiskedLeverage > 1.5}"> 
                            (Leverage - {{uiSnapTable.totalMaxRiskedLeverage | number :'1.1-2'}})*
                         </span>
                        <div class="tooltipSnap">
                            <div class="snapshot">
                                LongStk + ShortStk (incorrect! Infinite) <br>
                                + LongOptMktValue + ShortOptMktValue (incorrect! Infinite) <br>
                                Leverage greater than 1.5 -> red <br>
                                Leverage between 1.3 - 1.5 -> orange <br>
                                Leverage less than 1.3 -> green
                            </div>
                        </div>
                    </div>
                    <div class="tooltipCell">Delta Adjusted Bullish/<br>Bearish Market Orientation:
                        <div class="tooltipSnap">
                            <div class="snapshot">
                                LongStock - ShortStock + dAdj.CallOption <br>
                                 - dAdj.PutOption
                            </div>
                        </div>
                    </div>
                    <div class="tooltipCell">Beta Delta Adjusted Bullish/<br>Bearish Market Orientation :
                        <div class="tooltipSnap">
                            <div class="snapshot">
                                approx. mkt exposure sum
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div [hidden]="tabPageVisibleIdx == 1" id="tab2">
                <div >
                   <span>
                    <div class="chrtTimeFrameSelection">
                        <select [(ngModel)] = "yrSelectionSelected">
                            <option *ngFor="let item of yrSelectionChoices" [value]="item">{{item}}</option>YTD
                        </select>
                        <div>StartDate: <input type="date" id="StartDate" name="startDate" min="01-01-1975" [(ngModel)]="lookbackStartETstr"></div>
                        <div>EndDate: <input type="date" id="EndDate" name="EndDate" min="01-01-1975" [(ngModel)]="lookbackEndETstr"></div>
                        <div *ngFor="let item of uiHistData let i = index">MaxDD(NAV/BnchMrk):
                            <span *ngIf="i==0">{{i}}{{item.periodMaxDD | percent:'1.2'}}</span>
                            <span *ngIf="i==1">{{i}}{{item.periodMaxDD | percent:'1.2'}}</span> </div>
                        <div *ngFor="let item of uiHistData">Return(NAV/BnchMrk): {{item.periodReturn | percent:'1.2'}}</div>
                        <div>UiHistDataLength:{{uiHistData.length}}</div>
                       
                    </div>
                     <div id="my_dataviz"></div>
                   </span>
                </div>
            </div>
    </div>
</span>
</div>

<hr>
<div class="brAccSnapTbl">
<table class = "selectedBrcAccSnapShotTbl">
    <thead class = "selectedBrcAccSnapShotTbl">
        <tr class="tableHeader">
        <th [ngClass]="{'ActiveSortTableHeader':sortColumn ==='Symbol'}" (click)="onSortingClicked($event, 'Symbol')">Symbol</th>
        <th [ngClass]="{'ActiveSortTableHeader':sortColumn ==='LocalSymbol'}" >LocalSymbol</th>
        <th [ngClass]="{'ActiveSortTableHeader':sortColumn ==='Pos'}" (click)="onSortingClicked($event, 'Pos')">Pos</th>
        <th [ngClass]="{'ActiveSortTableHeader':sortColumn ==='Cost'}" (click)="onSortingClicked($event, 'Cost')">Cost</th>
        <th [ngClass]="{'ActiveSortTableHeader':sortColumn ==='PriorClose'}" (click)="onSortingClicked($event, 'PriorClose')">Prior<br>Close</th>
        <th [ngClass]="{'ActiveSortTableHeader':sortColumn ==='estPrice'}" (click)="onSortingClicked($event, 'estPrice')">Est<br>Price</th>
        <th [ngClass]="{'ActiveSortTableHeader':sortColumn ==='DailyPctChg'}" (click)="onSortingClicked($event, 'DailyPctChg')">Chg%<br>Today</th>
        <th [ngClass]="{'ActiveSortTableHeader':sortColumn ==='DailyPL'}" (click)="onSortingClicked($event, 'DailyPL')">P&L<br>Today</th>
        <th [ngClass]="{'ActiveSortTableHeader':sortColumn ==='ProfLos'}"(click)="onSortingClicked($event, 'ProfLos')">P&L</th>
        <th [ngClass]="{'ActiveSortTableHeader':sortColumn ==='MktVal'}"(click)="onSortingClicked($event, 'MktVal')">MktVal</th>
        <th [ngClass]="{'ActiveSortTableHeader':sortColumn ==='EstUndPrice'}"(click)="onSortingClicked($event, 'EstUndPrice')">Est<br>UndPr</th>
        <th [ngClass]="{'ActiveSortTableHeader':sortColumn ==='IbCompUndPr'}"(click)="onSortingClicked($event, 'IbCompUndPr')">IbComp<br>UndPr</th>
        <th [ngClass]="{'ActiveSortTableHeader':sortColumn ==='IbCompDeltar'}"(click)="onSortingClicked($event, 'IbCompDeltar')">IbComp<br>Delta</th>
        <th [ngClass]="{'ActiveSortTableHeader':sortColumn ==='DelivVal'}"(click)="onSortingClicked($event, 'DelivVal')">Deliv<br>Value</th>
        <th [ngClass]="{'ActiveSortTableHeader':sortColumn ==='DltAdjDelivVal'}"(click)="onSortingClicked($event, 'DltAdjDelivVal')">DltAdj<br>DelivVal</th>
        <th [ngClass]="{'ActiveSortTableHeader':sortColumn ==='gBeta'}"(click)="onSortingClicked($event, 'gBeta')">gBeta</th>
        <th [ngClass]="{'ActiveSortTableHeader':sortColumn ==='gBetaDltAdj'}"(click)="onSortingClicked($event, 'gBetaDltAdj')">BetaDltAdj<br>MktOriVal</th>
        <th [ngClass]="{'ActiveSortTableHeader':sortColumn ==='Acc'}"(click)="onSortingClicked($event, 'Acc')">Acc</th>
        </tr>
    </thead>
    <tbody class = "selectedBrcAccSnapShotTbl">
    <tr *ngFor="let item of uiSnapTable.poss">
        <td class="tooltipStck" [ngStyle]="{'font-weight': 'bold'}">
            <span class="tooltipSnap">
                <span class="snapshot">Name:
                    {{item.name}} <br>
                    <a href="https://uk.tradingview.com/chart/?symbol={{item.symbol}}" target="_blank">
                        <svg width="28" height="22" viewBox="0 0 28 22" xmlns="http://www.w3.org/2000/svg" >
                            <path d="M 12 20 H 7 V 11 H 0 V 4 h 12 v 16 z 
                                     M 24 20 h-8 l 7.5-18 h 8 L 22 20 z" fill="currentColor">
                            </path>
                            <circle cx="16.5" cy="7" r="4" fill="currentColor"/>
                        </svg>
                    </a>, 
                    <a href="https://finance.yahoo.com/quote/{{item.symbol}}" target="_blank"><img border='0' alt='YF' src='../assets/images/YF.webp' width='20' height='20'></a>,
                    <a href="https://www.zacks.com/stock/quote/{{item.symbol}}" target="_blank"><img border='0' alt='Zacks' src='../assets/images/Zacks.webp' width='20' height='20'></a>,
                    <a href="https://www.earningswhispers.com/tradeview/{{item.symbol}}" target="_blank"><img border='earningswhispers-BeforeEarnings' alt='YF' src='../assets/images/EW-BE.webp' width='20' height='20'></a>,
                    <a href="https://www.earningswhispers.com/epsdetails/{{item.symbol}}" target="_blank"><img border='0' alt='earningswhispers-AfterEarnings' src='../assets/images/EW-AE.webp' width='20' height='20'></a>,
                    <a href="https://www.tipranks.com/stocks/{{item.symbol}}/forecast" target="_blank"><img border='0' alt='TipRanks' src='../assets/images/TR.webp' width='20' height='20'></a>,
                    <a href="https://stockcharts.com/h-sc/ui?s={{item.symbol}}" target="_blank"><img border='0' alt='stocksCharts' src='../assets/images/SC.webp' width='20' height='20'></a> <br>
                    <svg style="border: solid 1px blue">
                        <rect x = 10 y =10 width = 20 height = 20></rect>
                    </svg>
                </span>
            </span>
            <a href="https://uk.tradingview.com/chart/?symbol={{item.symbol}}" target="_blank">
                {{item.symbol}}
            </a>
        </td>
        <td></td>
        <td>{{item.pos | number}}</td>
        <td>{{item.avgCost | number:'1.2-2'}}</td>
        <td>{{item.priorClose | number:'1.2-2'}}</td>
        <td>{{item.estPrice | number:'1.2-2'}}</td>
        <td [ngClass]="{
            'mktBarPositivePerf' : item.pctChgTod > 0,
            'mktbarNegativePerf' : item.pctChgTod < 0
         }">{{item.pctChgTod | percent:'1.2'}}</td>
        <td >{{item.plTod | number}}</td>
        <td>{{item.pl | number}}</td>
        <td>{{item.mktVal | number}}</td>
        <td>{{item.estUndPrice}}</td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td>{{item.gBeta | number:'1.1-2'}}</td>
        <td>{{item.betaDltAdj | number}}</td>
        <td>{{item.accId}}</td>
    </tr>
    </tbody>
</table>
</div>
<hr>
<!-- Addded class "selectedTempDebug" to limit the text output in the UI-->
<div class="selectedTempDebug">
<br><br>Temporary Debug Info:<br>
<div class="tooltipTempDebug">HandshakeMsgStr:
    <div class="tooltipSnap">
        <div class="snapshot">
            {{handshakeStrFormatted}}
        </div>
    </div>
</div>
<div class="tooltipTempDebug">MarketBarLastClosesStr:
    <div class="tooltipSnap">
        <div class="snapshot">
            {{mktBrLstClsStrFormatted}}
        </div>
    </div>
</div>
<div class="tooltipTempDebug">HistStr:
    <div class="tooltipSnap">
        <div class="snapshot">
            {{histStrFormatted}}
        </div>
    </div>
</div>
<div class="tooltipTempDebug">BrAccountSnapshot:
    <div class="tooltipSnap">
        <div class="snapshot">
            {{brAccountSnapshotStrFormatted}}
        </div>
    </div>
</div>
</div>
<br><br><br>
<hr>
